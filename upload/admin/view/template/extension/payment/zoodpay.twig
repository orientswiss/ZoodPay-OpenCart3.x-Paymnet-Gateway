
{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <button type="submit" form="form_payment" data-toggle="tooltip" title="{{ button_save }}"
                        class="btn btn-primary"><i class="fa fa-save"></i></button>
                <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i
                            class="fa fa-reply"></i></a>
            </div>
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="container-fluid">
        {% if error_warning %}
            <div class="alert alert-danger alert-dismissible"><i
                        class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
            </div>
            <div class="panel-body">
                <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form_payment"
                      class="form-horizontal">
                    <ul class="nav nav-tabs">
                        <li class="nav-tab active"><a href="#tab_general" data-toggle="tab">{{ text_general }}</a></li>
                        <li class="nav-tab "><a href="#tab_additional" data-toggle="tab">{{ text_additional_tab }}</a></li>
{#    //Added for Status                    #}
                        <li class="nav-tab "><a href="#tab_order_status" data-toggle="tab">{{ text_order_status_tab }}</a></li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane active" id="tab_general">
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="input_environment">{{ entry_environment }}</label>
                                <div class="col-sm-10">
                                    <input name="payment_zoodpay_environment" id="input_environment"
                                           placeholder="{{ entry_environment }}" value="{{ environment }}"
                                           class="form-control"/>
                                </div>

                            </div>


                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="button_healthcheck">{{ healthcheck }}</label>
                                <div class="col-sm-2 control-label" style = "text-align: left">
                                    <input  type="button" id="button_healthcheck" value="{{ healthcheck }}"
                                            class="button "/>
                                </div>
                                <div class="col-sm-8">
                                    <input  type="text" disabled id="help_healthcheck" placeholder="please check server before getting configuration"
                                            class="form-control"/>
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input_merchant_key"><span
                                            data-toggle="tooltip"
                                            title="{{ help_merchant_key }}">{{ entry_merchant_key }}</span></label>
                                <div class="col-sm-10">
                                    <input type="text" name="payment_zoodpay_merchant_key" value="{{ merchant_key }}"
                                           placeholder="{{ entry_merchant_key }}" id="input_merchant_key"
                                           class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input_merchant_secret"><span
                                            data-toggle="tooltip"
                                            title="{{ help_merchant_secret }}">{{ entry_merchant_secret }}</span></label>
                                <div class="col-sm-10">
                                    <input type="password" name="payment_zoodpay_merchant_secret"
                                           value="{{ merchant_secret }}" placeholder="{{ entry_merchant_secret }}"
                                           id="input_merchant_secret" class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input_salt_key"><span>{{ entry_merchant_salt_key }}</span></label>
                                <div class="col-sm-10">
                                    <input type="password" name="payment_zoodpay_salt_key" value="{{ salt_key }}"
                                           placeholder="{{ entry_merchant_salt_key }}" id="input_salt_key"
                                           class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input_merchant_tc"><span
                                            data-toggle="tooltip"
                                            title="{{ help_merchant_tc }}">{{ entry_merchant_tc }}</span></label>
                                <div class="col-sm-10">
                                    <input type="text" name="payment_zoodpay_merchant_tc" value="{{ merchant_tc }}"
                                           placeholder="{{ entry_merchant_tc }}" id="input_merchant_tc"
                                           class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="input_status">{{ entry_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_status" id="input_status" class="form-control">
                                        {% if status %}
                                            <option value="1" selected="selected">{{ text_enabled }}</option>
                                            <option value="0">{{ text_disabled }}</option>
                                        {% else %}
                                            <option value="1">{{ text_enabled }}</option>
                                            <option value="0" selected="selected">{{ text_disabled }}</option>
                                        {% endif %}
                                    </select>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="col-sm-2 control-label text-right"
                                       for="input_status">{{ text_get_configuration }}</label>
                                <div class="col-sm-10">
                                    <div id="zoodpay_form">
                                        <input type="button" id="button-configure" class="button" value="{{ text_get_configuration }}">
                                    </div>
                                </div>
                            </div>

                            <input type = "hidden" name="payment_zoodpay_should_match_limit" value="1"/>


                        </div>
                        <div class="tab-pane" id="tab_additional">
{#                            <div class="form-group">#}
{#                                <label class="col-sm-2 control-label"#}
{#                                       for="label_ipn">{{ entry_IPN }}</label>#}
{#                                <div class="col-sm-10">#}
{#                                    <span  id="label_ipn" class="form-control">#}
{#                                        {{ IPN_url }}#}
{#                                    </span>#}
{#                                </div>#}

{#                            </div>#}
{#                            #}

                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="label_success">{{ entry_success }}</label>
                                <div class="col-sm-10">
                                    <span  id="label_success" class="form-control">
                                        {{ success_url }}
                                    </span>
                                </div>

                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="label_error">{{ entry_error }}</label>
                                <div class="col-sm-10">
                                    <span  id="label_error" class="form-control">
                                        {{ error_url }}
                                    </span>
                                </div>

                            </div>
{#                            <div class="form-group">#}
{#                                <label class="col-sm-2 control-label"#}
{#                                       for="label_refund">{{ entry_refund }}</label>#}
{#                                <div class="col-sm-10">#}
{#                                    <span  id="label_refund" class="form-control">#}
{#                                        {{ refund_url }}#}
{#                                    </span>#}
{#                                </div>#}

{#                            </div>#}
                        </div>

                        {#                        //Added for the Status#}

                        <div class="tab-pane" id="tab_order_status">

                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_complete_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_complete_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_complete_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_processing_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_processing_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_processing_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
{#                            <div class="form-group">#}
{#                                <label class="col-sm-2 control-label">{{ entry_processed_status }}</label>#}
{#                                <div class="col-sm-10">#}
{#                                    <select name="payment_zoodpay_processed_status_id" class="form-control">#}
{#                                        {% for order_status in order_statuses %}#}
{#                                            {% if order_status.order_status_id == payment_zoodpay_processed_status_id %}#}
{#                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>#}
{#                                            {% else %}#}
{#                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>#}
{#                                            {% endif %}#}
{#                                        {% endfor %}#}
{#                                    </select>#}
{#                                </div>#}
{#                            </div>#}



                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_failed_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_failed_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_failed_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_cancelled_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_cancelled_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_cancelled_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_pending_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_pending_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_pending_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_refund_initiated_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_refund_initiated_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_refund_initiated_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_refund_approved_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_refund_approved_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_refund_approved_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">{{ entry_refund_declined_status }}</label>
                                <div class="col-sm-10">
                                    <select name="payment_zoodpay_refund_declined_status_id" class="form-control">
                                        {% for order_status in order_statuses %}
                                            {% if order_status.order_status_id == payment_zoodpay_refund_declined_status_id %}
                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                            {% else %}
                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                        </div>

                    </div>
                </form>


            </div>
        </div>
{#        <div class="panel panel-default">#}
{#            <div class="panel-heading">#}
{#                <h3 class="panel-title"><i class="fa fa-list"></i>{{ text_zoodpay_orders }}</h3>#}
{#            </div>#}
{#            <div class="panel-body">#}
{#                <div class="table-responsive" id="table_orders">#}
{#                    <table class="table table-bordered table-hover">#}
{#                        <thead>#}
{#                        <tr>#}
{#                            <td style="width: 1px;" class="text-center"><input type="checkbox"#}
{#                                                                               onclick="$('input[name*=\'selected\']').prop('checked', this.checked);"/>#}
{#                            </td>#}
{#                            <td class="text-right">{% if sort == 'o.order_id' %} <a href="{{ sort_order }}"#}
{#                                                                                    class="{{ order|lower }}">{{ column_order_id }}</a> {% else %}#}
{#                                    <a href="{{ sort_order }}">{{ column_order_id }}</a> {% endif %}</td>#}
{#                            <td class="text-left">{% if sort == 'customer' %} <a href="{{ sort_customer }}"#}
{#                                                                                 class="{{ order|lower }}">{{ column_customer }}</a> {% else %}#}
{#                                    <a href="{{ sort_customer }}">{{ column_customer }}</a> {% endif %}</td>#}
{#                            <td class="text-left">{% if sort == 'order_status' %} <a href="{{ sort_status }}"#}
{#                                                                                     class="{{ order|lower }}">{{ column_status }}</a> {% else %}#}
{#                                    <a href="{{ sort_status }}">{{ column_status }}</a> {% endif %}</td>#}
{#                            <td class="text-right">{% if sort == 'o.total' %} <a href="{{ sort_total }}"#}
{#                                                                                 class="{{ order|lower }}">{{ column_total }}</a> {% else %}#}
{#                                    <a href="{{ sort_total }}">{{ column_total }}</a> {% endif %}</td>#}
{#                            <td class="text-left">{% if sort == 'o.date_added' %} <a href="{{ sort_date_added }}"#}
{#                                                                                     class="{{ order|lower }}">{{ column_date_added }}</a> {% else %}#}
{#                                    <a href="{{ sort_date_added }}">{{ column_date_added }}</a> {% endif %}</td>#}
{#                            <td class="text-left">{% if sort == 'o.date_modified' %} <a href="{{ sort_date_modified }}"#}
{#                                                                                        class="{{ order|lower }}">{{ column_date_modified }}</a> {% else %}#}
{#                                    <a href="{{ sort_date_modified }}">{{ column_date_modified }}</a> {% endif %}</td>#}
{#                            <td class="text-right">{{ column_action }}</td>#}
{#                        </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                        {% if orders %}#}
{#                            {% for order in orders %}#}
{#                                <tr>#}
{#                                    <td class="text-center"> {% if order.order_id in selected %}#}
{#                                            <input type="checkbox" name="selected[]" value="{{ order.order_id }}"#}
{#                                                   checked="checked"/>#}
{#                                        {% else %}#}
{#                                            <input type="checkbox" name="selected[]" value="{{ order.order_id }}"/>#}
{#                                        {% endif %}#}
{#                                        <input type="hidden" name="shipping_code[]" value="{{ order.shipping_code }}"/>#}
{#                                    </td>#}
{#                                    <td class="text-right orderID">{{ order.order_id }}</td>#}
{#                                    <td class="text-left">{{ order.customer }}</td>#}
{#                                    <td class="text-left">{{ order.order_status }}</td>#}
{#                                    <td class="text-right orderTotal">{{ order.total }}</td>#}
{#                                    <td class="text-left">{{ order.date_added }}</td>#}
{#                                    <td class="text-left">{{ order.date_modified }}</td>#}
{#                                    <td class="text-right">#}
{#                                        <div style="min-width: 120px;">#}
{#                                            <div class="btn-group"><a href="{{ order.view }}" data-toggle="tooltip"#}
{#                                                                      title="{{ button_view }}" class="btn btn-primary"><i#}
{#                                                            class="fa fa-eye"></i></a>#}
{#                                            </div>#}
{#                                            <div class="btn-group"><a data-method="refundOrder" data-toggle="tooltip"#}
{#                                                                      title="{{ button_refund }}"#}
{#                                                                      class=" button-zoodpay btn btn-primary"><i#}
{#                                                            class="fa fa-undo"></i></a>#}
{#                                            </div>#}
{#                                            <div class="btn-group"><a data-method="deliveryOrder" data-toggle="tooltip"#}
{#                                                                      title="{{ button_delivery }}"#}
{#                                                                      class="button-zoodpay btn btn-primary"><i#}
{#                                                            class="fa fa-truck"></i></a>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </td>#}
{#                                </tr>#}
{#                            {% endfor %}#}
{#                        {% else %}#}
{#                            <tr>#}
{#                                <td class="text-center" colspan="8">{{ text_no_results }}</td>#}
{#                            </tr>#}
{#                        {% endif %}#}
{#                        </tbody>#}

{#                    </table>#}
{#                </div>#}
{#                <div class="row">#}
{#                    <div class="col-sm-6 text-left">{{ pagination }}</div>#}
{#                    <div class="col-sm-6 text-right">{{ results }}</div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
    </div>
</div>
<script type="text/javascript">
    $('#button-configure').on('click', function () {
        $.ajax({
            url: 'index.php?route=extension/payment/zoodpay/buildConfiguration&user_token={{ user_token }}',
            data: {
                'merchant_secret': $('#input_merchant_secret').val(),
                'merchant_key': $('#input_merchant_key').val(),
                'environment': $('#input_environment').val(),
                'salt_key': $('#input_salt_key').val()
            },
            type: 'post',
            dataType: 'json',
            beforeSend: function () {
                $('#button-configure').button('loading');
            },
            success: function (json) {
                $('.alert-dismissible').remove();
                $('#button-configure').button('reset');
                if (json['success']) {
                    $('#zoodpay_form').prepend('<div id="message_error" class="alert alert-success alert-dismissible"><i class="fa fa-info-circle"></i> ' + json['success'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }
                if (json['error']) {
                    for (const [key, value] of Object.entries(json['error'])) {
                        if (key === 'details') {
                            for (const [key1, value1] of Object.entries(value)){
                                $('#zoodpay_form').prepend('<div id="message_error3" class="alert alert-dismissible alert-warning"><i class="fa fa-info-circle"></i> ' + value1.field +' : '+value1.error + '</div>');
                            }
                        } else if (key === 'message') {
                            $('#zoodpay_form').prepend('<div id="message_error3" class="alert alert-dismissible alert-warning"><i class="fa fa-info-circle"></i> ' + value + '</div>');
                        }
                    }
                }
                if (json['error1']) {
                    for (const [key, value] of Object.entries(json['error1'])) {
                        $('#zoodpay_form').prepend('<div id="message_error3" class="alert alert-dismissible alert-warning"><i class="fa fa-info-circle"></i> ' + value+ '</div>');
                    }
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
    $('.button-zoodpay').on('click', function (e) {
        e.preventDefault();
        $.ajax({
            url: 'index.php?route=extension/payment/zoodpay/modal&user_token={{ user_token }}',
            data: 'amount=' + $(this).parents("tr").children('.orderTotal') + '&method=' + $(this).data("method") + '&order_id=' + $(this).parents("tr").children('.orderID').text(),
            type: 'post',
            dataType: 'html',
            success: function (html) {
                $('#modal-developer').remove();

                $('.alert-dismissible').remove();

                $('body').prepend('<div id="modal-developer" class="modal">' + html + '</div>');

                $('#modal-developer').modal('show');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });

    var entry_healthcheck = '{{ entry_healthcheck }}';
    var text_configuration = '{{ text_get_configuration }}';
    var server_succes = '{{ healthcheck_success }}';
    $('#input_environment').on ('keyup', function (e) {
        $('#help_healthcheck').removeClass('alert-error');
        $('#help_healthcheck').removeClass('alert-success');
        $('#help_healthcheck').val(entry_healthcheck);
    });
    $('#button_healthcheck').on ('click', function (e) {
        $.ajax({
            url: 'index.php?route=extension/payment/zoodpay/healthcheck&user_token={{ user_token }}',
            data: 'url='+$('#input_environment').val(),
            type: 'post',
            dataType: 'json',
            success: function (json) {
                console.log(json);
                if (json['response']) {
                    $('#help_healthcheck').val(json['response']);
                    $('#help_healthcheck').removeClass('alert-success');
                    $('#help_healthcheck').addClass('alert-error');
                } else {
                    $('#help_healthcheck').val(server_succes);
                    $('#help_healthcheck').removeClass('alert-error');
                    $('#help_healthcheck').addClass('alert-success');
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });

</script>
{{ footer }}

